(function(v,I,g,i,C,P,c,R,y,$,p){"use strict";const A=i.stylesheet.createThemedStyleSheet({headerStyleIcon:{marginRight:10,tintColor:y.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:y.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:y.semanticColors.TEXT_DANGER}});function T(e){let{onPress:o,icon:a,style:d,destructive:f}=e;return React.createElement(i.ReactNative.TouchableOpacity,{onPress:o},React.createElement(i.ReactNative.Image,{style:[d==="header"?A.headerStyleIcon:A.cardStyleIcon,f&&A.destructiveIcon].filter(function(s){return!!s}),source:a}))}const{FormRow:b}=R.Forms,_=i.stylesheet.createThemedStyleSheet({card:{backgroundColor:y.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:y.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function M(e){const[,o]=React.useReducer(function(a){return~a},0);return React.createElement(i.ReactNative.View,{style:[_.card,{marginBottom:10}]},React.createElement(b,{style:_.header,label:e.headerLabel,leading:e.headerIcon&&React.createElement(b.Icon,{source:e.headerIcon})}),React.createElement(b,{label:e.descriptionLabel,trailing:React.createElement(i.ReactNative.View,{style:_.actions},e.actions?.().map(function(a){let{icon:d,onPress:f,destructive:s}=a;return React.createElement(T,{icon:d,onPress:function(){f(function(){return o()})},style:"card",destructive:s??!1})}))}))}const{showSimpleActionSheet:G}=g.findByProps("showSimpleActionSheet"),{TextStyleSheet:D}=g.findByProps("TextStyleSheet"),x=i.stylesheet.createThemedStyleSheet({text:{...D["text-md/medium"],color:y.semanticColors.TEXT_NORMAL},link:{...D["text-md/bold"],color:y.semanticColors.TEXT_LINK}}),{Text:L,View:j}=R.General;var l;(function(e){e.Newest="Newest",e.Oldest="Oldest",e.Alphabetical="Alphabetical",e.ReverseAlphabetical="Reverse Alphabetical"})(l||(l={}));function k(){const e={},[o,a]=React.useState(!1),[d,f]=React.useState(l.Newest),[s,N]=React.useState({}),[h,S]=React.useState("");React.useEffect(function(){S(""),f(l.Newest)},[]);const w=i.NavigationNative.useNavigation();if(!s.parsed&&!o&&(a(!0),P.safeFetch("https://vd-plugins.github.io/proxy/plugins-full.json",{cache:"no-store"}).then(function(n){return n.json()}).then(function(n){N({parsed:n}),a(!1)})),w.setOptions({title:"Plugin Browser",headerRight:function(){return React.createElement(j,{style:{flexDirection:"row-reverse"}},React.createElement(T,{onPress:function(){return!o&&N({parsed:void 0})},icon:c.getAssetIDByName("ic_sync_24px"),style:"header"}),React.createElement(T,{onPress:function(){return!o&&G({key:"CardOverflow",options:Object.values(l).map(function(n){return{label:n,onPress:function(){return f(n)}}})})},icon:c.getAssetIDByName("ic_filter"),style:"header"}))}}),o||!s.parsed)return React.createElement(i.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let m=s.parsed.filter(function(n){return n.name?.toLowerCase().includes(h)||n.authors?.some(function(t){return t.name?.toLowerCase().includes(h)})||n.description?.toLowerCase().includes(h)});return[l.Alphabetical,l.ReverseAlphabetical].includes(d)&&(m=m.sort(function(n,t){return n.name<t.name?-1:n.name>t.name?1:0})),[l.ReverseAlphabetical,l.Newest].includes(d)&&m.reverse(),React.createElement(i.ReactNative.FlatList,{ListHeaderComponent:React.createElement(R.Search,{style:{marginBottom:10},onChangeText:function(n){return S(n.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:m,renderItem:function(n){let{item:t,index:J}=n;return React.createElement(M,{index:J,headerLabel:React.createElement(L,{style:x.text},t.name,t.authors[0]&&" by ",...t.authors.map(function(r,E,u){return React.createElement(React.Fragment,null,React.createElement(L,{onPress:function(){return F(r.id)},style:x.link},r.name),E!==u.length-1&&", ")})),headerIcon:c.getAssetIDByName(t.vendetta.icon),descriptionLabel:t.description,actions:function(){const r=`https://vd-plugins.github.io/proxy/${t.vendetta.original}`,E=$.plugins.plugins[r];return E?[E.manifest.hash!==t.hash&&{icon:c.getAssetIDByName("ic_sync_24px"),onPress:async function(u){if(!e[r]){e[r]=!0;try{await O(r),p.showToast(`Successfully updated ${t.name}.`,c.getAssetIDByName("ic_sync_24px"))}catch{p.showToast(`Failed to update ${t.name}!`,c.getAssetIDByName("Small"))}delete e[r],u()}}},{icon:c.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(u){if(!e[r]){e[r]=!0;try{I.removePlugin(r),p.showToast(`Successfully deleted ${t.name}.`,c.getAssetIDByName("ic_message_delete"))}catch{p.showToast(`Failed to delete ${t.name}!`,c.getAssetIDByName("Small"))}delete e[r],u()}}}].filter(function(u){return!!u}):[{icon:c.getAssetIDByName("ic_download_24px"),onPress:async function(u){if(!e[r]){e[r]=!0;try{await I.installPlugin(r),p.showToast(`Successfully installed ${t.name}.`,c.getAssetIDByName("toast_image_saved"))}catch(Q){p.showToast(Q?.message??`Failed to install ${t.name}!`,c.getAssetIDByName("Small"))}delete e[r],u()}}}]}})}})}const{FormRow:B}=R.Forms;function V(){const e=i.NavigationNative.useNavigation();return React.createElement(R.ErrorBoundary,null,React.createElement(B,{label:"Plugin Browser",leading:React.createElement(B.Icon,{source:c.getAssetIDByName("ic_search_items_24px")}),trailing:B.Arrow,onPress:function(){return e.push("VendettaCustomPage",{render:k})}}))}const{FormSection:z}=R.Forms,H=g.findByName("UserSettingsOverviewWrapper",!1);function K(){let e=[],o=C.after("default",H,function(a,d){o();const f=P.findInReactTree(d.props.children,function(s){return s.type&&s.type.name==="UserSettingsOverview"});e.push(C.after("render",f.type.prototype,function(s,N){let{props:{children:h}}=N;const S=[i.i18n.Messages.BILLING_SETTINGS,i.i18n.Messages.PREMIUM_SETTINGS];h=P.findInReactTree(h,function(m){return m.children[1].type===z}).children;const w=h.findIndex(function(m){return S.includes(m?.props.label)});h.splice(w===-1?4:w,0,React.createElement(V,null))}))},!0);return function(){return e.forEach(function(a){return a()})}}const X=g.findByStoreName("UserStore"),{showUserProfile:Y}=g.findByProps("showUserProfile"),{fetchProfile:W}=g.findByProps("fetchProfile");async function O(e){const o=e.enabled;for(let a=0;a<2;a++)o&&I.stopPlugin(e.id,!1),await I.fetchPlugin(e.id),o&&await I.startPlugin(e.id)}async function F(e){X.getUser(e)||await W(e),Y({userId:e})}let U;var q={onLoad:function(){return U=K()},onUnload:function(){return U?.()}};return v.default=q,v.openProfile=F,v.refetchPlugin=O,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.plugins,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta,vendetta.ui.toasts);
