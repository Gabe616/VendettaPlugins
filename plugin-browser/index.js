(function(I,N,g,e,C,T,s,p,R,U,v){"use strict";const{TextStyleSheet:G}=g.findByProps("TextStyleSheet"),{View:te,Text:M}=p.General;var m;(function(t){function c(a){let{children:o}=a;return e.React.createElement(M,{style:G["text-md/bold"]},o)}t.Bold=c})(m||(m={}));function A(t){let{onPress:c,icon:a,style:o,destructive:f}=t;const l=e.stylesheet.createThemedStyleSheet({headerStyleIcon:{marginRight:10,tintColor:R.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:R.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:R.semanticColors.TEXT_DANGER}});return e.React.createElement(e.ReactNative.TouchableOpacity,{onPress:c},e.React.createElement(e.ReactNative.Image,{style:[typeof o=="string"?o==="header"?l.headerStyleIcon:l.cardStyleIcon:o,f&&l.destructiveIcon].filter(function(S){return!!S}),source:a}))}const{FormRow:b}=p.Forms,B=e.stylesheet.createThemedStyleSheet({card:{backgroundColor:R.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:R.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function V(t){const[,c]=e.React.useReducer(function(a){return~a},0);return e.React.createElement(e.ReactNative.View,{style:[B.card,{marginBottom:10}]},e.React.createElement(b,{style:B.header,label:t.headerLabel,leading:t.headerIcon&&e.React.createElement(b.Icon,{source:t.headerIcon})}),e.React.createElement(b,{label:t.descriptionLabel,trailing:e.React.createElement(e.ReactNative.View,{style:B.actions},t.actions?.().map(function(a){let{icon:o,onPress:f,destructive:l}=a;return e.React.createElement(A,{icon:o,onPress:function(){f(function(){return c()})},style:"card",destructive:l??!1})}))}))}const{showSimpleActionSheet:k}=g.findByProps("showSimpleActionSheet"),{TextStyleSheet:x}=g.findByProps("TextStyleSheet"),D=e.stylesheet.createThemedStyleSheet({text:{...x["text-md/medium"],color:R.semanticColors.TEXT_NORMAL},link:{...x["text-md/bold"],color:R.semanticColors.TEXT_LINK}}),{Text:L,View:j}=p.General;var u;(function(t){t.Newest="Newest",t.Oldest="Oldest",t.Alphabetical="Alphabetical",t.ReverseAlphabetical="Reverse Alphabetical"})(u||(u={}));function H(){const t={},[c,a]=e.React.useState(!1),[o,f]=e.React.useState(u.Newest),[l,S]=e.React.useState({}),[h,w]=e.React.useState("");e.React.useEffect(function(){w(""),f(u.Newest)},[]);const E=e.NavigationNative.useNavigation();if(!l.parsed&&!c&&(a(!0),T.safeFetch("https://vd-plugins.github.io/proxy/plugins-full.json",{cache:"no-store"}).then(function(r){return r.json()}).then(function(r){S({parsed:r}),a(!1)})),E.setOptions({title:"Plugin Browser",headerRight:function(){return e.React.createElement(j,{style:{flexDirection:"row-reverse"}},e.React.createElement(A,{onPress:function(){return!c&&S({parsed:void 0})},icon:s.getAssetIDByName("ic_sync_24px"),style:"header"}),e.React.createElement(A,{onPress:function(){return!c&&k({key:"CardOverflow",options:Object.values(u).map(function(r){return{label:r,onPress:function(){return f(r)}}})})},icon:s.getAssetIDByName("ic_filter"),style:"header"}))}}),c||!l.parsed)return e.React.createElement(e.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let y=l.parsed.filter(function(r){return r.name?.toLowerCase().includes(h)||r.authors?.some(function(n){return n.name?.toLowerCase().includes(h)})||r.description?.toLowerCase().includes(h)});return[u.Alphabetical,u.ReverseAlphabetical].includes(o)&&(y=y.sort(function(r,n){return r.name<n.name?-1:r.name>n.name?1:0})),[u.ReverseAlphabetical,u.Newest].includes(o)&&y.reverse(),e.React.createElement(e.ReactNative.FlatList,{ListHeaderComponent:e.React.createElement(p.Search,{style:{marginBottom:10},onChangeText:function(r){return w(r.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:y,renderItem:function(r){let{item:n,index:Z}=r;return e.React.createElement(V,{index:Z,headerLabel:e.React.createElement(L,{style:D.text},n.name,n.authors[0]&&" by ",...n.authors.map(function(i,P,d){return e.React.createElement(e.React.Fragment,null,e.React.createElement(L,{onPress:function(){return F(i.id)},style:D.link},i.name),P!==d.length-1&&", ")})),headerIcon:s.getAssetIDByName(n.vendetta.icon),descriptionLabel:n.description,actions:function(){const i=`https://vd-plugins.github.io/proxy/${n.vendetta.original}`,P=U.plugins.plugins[i];return P?[P.manifest.hash!==n.hash&&{icon:s.getAssetIDByName("ic_sync_24px"),onPress:async function(d){if(!t[i]){t[i]=!0;try{await O(i),v.showToast(`Successfully updated ${n.name}.`,s.getAssetIDByName("ic_sync_24px"))}catch{v.showToast(`Failed to update ${n.name}!`,s.getAssetIDByName("Small"))}delete t[i],d()}}},{icon:s.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(d){if(!t[i]){t[i]=!0;try{N.removePlugin(i),v.showToast(`Successfully deleted ${n.name}.`,s.getAssetIDByName("ic_message_delete"))}catch{v.showToast(`Failed to delete ${n.name}!`,s.getAssetIDByName("Small"))}delete t[i],d()}}}].filter(function(d){return!!d}):[{icon:s.getAssetIDByName("ic_download_24px"),onPress:async function(d){if(!t[i]){t[i]=!0;try{await N.installPlugin(i),v.showToast(`Successfully installed ${n.name}.`,s.getAssetIDByName("toast_image_saved"))}catch(ee){v.showToast(ee?.message??`Failed to install ${n.name}!`,s.getAssetIDByName("Small"))}delete t[i],d()}}}]}})}})}const{FormRow:_}=p.Forms;function z(){const t=e.NavigationNative.useNavigation();return React.createElement(p.ErrorBoundary,null,React.createElement(_,{label:"Plugin Browser",leading:React.createElement(_.Icon,{source:s.getAssetIDByName("ic_search_items_24px")}),trailing:_.Arrow,onPress:function(){return t.push("VendettaCustomPage",{render:H})}}))}const{FormSection:K}=p.Forms,X=g.findByName("UserSettingsOverviewWrapper",!1);function Y(){let t=[],c=C.after("default",X,function(a,o){c();const f=T.findInReactTree(o.props.children,function(l){return l.type&&l.type.name==="UserSettingsOverview"});t.push(C.after("render",f.type.prototype,function(l,S){let{props:{children:h}}=S;const w=[e.i18n.Messages.BILLING_SETTINGS,e.i18n.Messages.PREMIUM_SETTINGS];h=T.findInReactTree(h,function(y){return y.children[1].type===K}).children;const E=h.findIndex(function(y){return w.includes(y?.props.label)});h.splice(E===-1?4:E,0,React.createElement(z,null))}))},!0);return function(){return t.forEach(function(a){return a()})}}const W=g.findByStoreName("UserStore"),{showUserProfile:q}=g.findByProps("showUserProfile"),{fetchProfile:J}=g.findByProps("fetchProfile");async function O(t){const c=t.enabled;for(let a=0;a<2;a++)c&&N.stopPlugin(t.id,!1),await N.fetchPlugin(t.id),c&&await N.startPlugin(t.id)}async function F(t){W.getUser(t)||await J(t),q({userId:t})}let $;var Q={onLoad:function(){return $=Y()},onUnload:function(){return $?.()}};return I.default=Q,I.openProfile=F,I.refetchPlugin=O,Object.defineProperty(I,"__esModule",{value:!0}),I})({},vendetta.plugins,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta,vendetta.ui.toasts);
