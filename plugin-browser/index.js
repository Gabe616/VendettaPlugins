(function(g,R,p,i,_,N,o,h,f,F,y){"use strict";const S=i.stylesheet.createThemedStyleSheet({headerStyleIcon:{marginRight:10,tintColor:f.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:f.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:f.semanticColors.TEXT_DANGER}}),B=function(e){let{onPress:a,icon:n,style:s,destructive:d}=e;return React.createElement(i.ReactNative.TouchableOpacity,{onPress:a},React.createElement(i.ReactNative.Image,{style:[s==="header"?S.headerStyleIcon:S.cardStyleIcon,d&&S.destructiveIcon].filter(function(l){return!!l}),source:n}))};function O(e){let{onPress:a,icon:n,style:s}=e;return function(){return React.createElement(B,{onPress:a,icon:n,style:s})}}const{FormRow:P}=h.Forms,T=i.stylesheet.createThemedStyleSheet({card:{backgroundColor:f.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:f.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function U(e){const[,a]=React.useReducer(function(n){return~n},0);return React.createElement(i.ReactNative.View,{style:[T.card,{marginBottom:10}]},React.createElement(P,{style:T.header,label:e.headerLabel,leading:e.headerIcon&&React.createElement(P.Icon,{source:e.headerIcon})}),React.createElement(P,{label:e.descriptionLabel,trailing:React.createElement(i.ReactNative.View,{style:T.actions},e.actions?.().map(function(n){let{icon:s,onPress:d,destructive:l}=n;return React.createElement(B,{icon:s,onPress:function(){d(function(){return a()})},style:"card",destructive:l??!1})}))}))}const{TextStyleSheet:A}=p.findByProps("TextStyleSheet"),C=i.stylesheet.createThemedStyleSheet({text:{...A["text-md/medium"],color:f.semanticColors.TEXT_NORMAL},link:{...A["text-md/bold"],color:f.semanticColors.TEXT_LINK}}),{Text:b}=h.General;function $(){const e={},[a,n]=React.useState(!1),[s,d]=React.useState({}),[l,I]=React.useState("");React.useEffect(function(){I("")},[]);const m=i.NavigationNative.useNavigation();return!s.parsed&&!a&&(n(!0),N.safeFetch("https://vd-plugins.github.io/proxy/plugins-full.json",{cache:"no-store"}).then(function(c){return c.json()}).then(function(c){d({parsed:c.reverse()}),n(!1)})),m.setOptions({title:"Plugin Browser",headerRight:O({onPress:function(){return!a&&d({parsed:void 0})},icon:o.getAssetIDByName("ic_sync_24px"),style:"header"})}),a||!s.parsed?React.createElement(i.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}}):React.createElement(i.ReactNative.FlatList,{ListHeaderComponent:React.createElement(h.Search,{style:{marginBottom:10},onChangeText:function(c){return I(c.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:s.parsed.filter(function(c){return c.name?.toLowerCase().includes(l)||c.authors?.some(function(t){return t.name?.toLowerCase().includes(l)})||c.description?.toLowerCase().includes(l)}),renderItem:function(c){let{item:t,index:v}=c;return React.createElement(U,{index:v,headerLabel:React.createElement(b,{style:C.text},t.name,t.authors[0]&&" by ",...t.authors.map(function(r,E,u){return React.createElement(React.Fragment,null,React.createElement(b,{onPress:function(){return x(r.id)},style:C.link},r.name),E!==u.length-1&&", ")})),headerIcon:o.getAssetIDByName(t.vendetta.icon),descriptionLabel:t.description,actions:function(){const r=`https://vd-plugins.github.io/proxy/${t.vendetta.original}`,E=F.plugins.plugins[r];return E?[E.manifest.hash!==t.hash&&{icon:o.getAssetIDByName("ic_sync_24px"),onPress:async function(u){if(!e[r]){e[r]=!0;try{await L(r),y.showToast(`Successfully updated ${t.name}.`,o.getAssetIDByName("ic_sync_24px"))}catch{y.showToast(`Failed to update ${t.name}!`,o.getAssetIDByName("Small"))}delete e[r],u()}}},{icon:o.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(u){if(!e[r]){e[r]=!0;try{R.removePlugin(r),y.showToast(`Successfully deleted ${t.name}.`,o.getAssetIDByName("ic_message_delete"))}catch{y.showToast(`Failed to delete ${t.name}!`,o.getAssetIDByName("Small"))}delete e[r],u()}}}].filter(function(u){return!!u}):[{icon:o.getAssetIDByName("ic_download_24px"),onPress:async function(u){if(!e[r]){e[r]=!0;try{await R.installPlugin(r),y.showToast(`Successfully installed ${t.name}.`,o.getAssetIDByName("toast_image_saved"))}catch(Y){y.showToast(Y?.message??`Failed to install ${t.name}!`,o.getAssetIDByName("Small"))}delete e[r],u()}}}]}})}})}const{FormRow:w}=h.Forms;function M(){const e=i.NavigationNative.useNavigation();return React.createElement(h.ErrorBoundary,null,React.createElement(w,{label:"Plugin Browser",leading:React.createElement(w.Icon,{source:o.getAssetIDByName("ic_search_items_24px")}),trailing:w.Arrow,onPress:function(){return e.push("VendettaCustomPage",{render:$})}}))}const{FormSection:G}=h.Forms,k=p.findByName("UserSettingsOverviewWrapper",!1);function V(){let e=[],a=_.after("default",k,function(n,s){a();const d=N.findInReactTree(s.props.children,function(l){return l.type&&l.type.name==="UserSettingsOverview"});e.push(_.after("render",d.type.prototype,function(l,I){let{props:{children:m}}=I;const c=[i.i18n.Messages.BILLING_SETTINGS,i.i18n.Messages.PREMIUM_SETTINGS];m=N.findInReactTree(m,function(v){return v.children[1].type===G}).children;const t=m.findIndex(function(v){return c.includes(v?.props.label)});m.splice(t===-1?4:t,0,React.createElement(M,null))}))},!0);return function(){return e.forEach(function(n){return n()})}}const j=p.findByStoreName("UserStore"),{showUserProfile:H}=p.findByProps("showUserProfile"),{fetchProfile:K}=p.findByProps("fetchProfile");async function L(e){const a=e.enabled;for(let n=0;n<2;n++)a&&R.stopPlugin(e.id,!1),await R.fetchPlugin(e.id),a&&await R.startPlugin(e.id)}async function x(e){j.getUser(e)||await K(e),H({userId:e})}let D;var X={onLoad:function(){return D=V()},onUnload:function(){return D?.()}};return g.default=X,g.openProfile=x,g.refetchPlugin=L,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.plugins,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta,vendetta.ui.toasts);
