(function(S,I,m,c,_,P,o,g,R,U,p){"use strict";const{TextStyleSheet:G}=m.findByProps("TextStyleSheet"),{View:te,Text:M}=g.General;var C;(function(e){function i(r){let{children:l}=r;return React.createElement(M,{style:G["text-md/bold"]},l)}e.Bold=i})(C||(C={}));function T(e){let{onPress:i,icon:r,style:l,destructive:f}=e;const s=c.stylesheet.createThemedStyleSheet({headerStyleIcon:{marginRight:10,tintColor:R.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:R.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:R.semanticColors.TEXT_DANGER}});return React.createElement(c.ReactNative.TouchableOpacity,{onPress:i},React.createElement(c.ReactNative.Image,{style:[l==="header"?s.headerStyleIcon:s.cardStyleIcon,f&&s.destructiveIcon].filter(function(v){return!!v}),source:r}))}const{FormRow:A}=g.Forms,b=c.stylesheet.createThemedStyleSheet({card:{backgroundColor:R.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:R.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function V(e){const[,i]=React.useReducer(function(r){return~r},0);return React.createElement(c.ReactNative.View,{style:[b.card,{marginBottom:10}]},React.createElement(A,{style:b.header,label:e.headerLabel,leading:e.headerIcon&&React.createElement(A.Icon,{source:e.headerIcon})}),React.createElement(A,{label:e.descriptionLabel,trailing:React.createElement(c.ReactNative.View,{style:b.actions},e.actions?.().map(function(r){let{icon:l,onPress:f,destructive:s}=r;return React.createElement(T,{icon:l,onPress:function(){f(function(){return i()})},style:"card",destructive:s??!1})}))}))}const{showSimpleActionSheet:j}=m.findByProps("showSimpleActionSheet"),{TextStyleSheet:x}=m.findByProps("TextStyleSheet"),D=c.stylesheet.createThemedStyleSheet({text:{...x["text-md/medium"],color:R.semanticColors.TEXT_NORMAL},link:{...x["text-md/bold"],color:R.semanticColors.TEXT_LINK}}),{Text:L,View:k}=g.General;var u;(function(e){e.Newest="Newest",e.Oldest="Oldest",e.Alphabetical="Alphabetical",e.ReverseAlphabetical="Reverse Alphabetical"})(u||(u={}));function z(){const e={},[i,r]=React.useState(!1),[l,f]=React.useState(u.Newest),[s,v]=React.useState({}),[h,N]=React.useState("");React.useEffect(function(){N(""),f(u.Newest)},[]);const w=c.NavigationNative.useNavigation();if(!s.parsed&&!i&&(r(!0),P.safeFetch("https://vd-plugins.github.io/proxy/plugins-full.json",{cache:"no-store"}).then(function(n){return n.json()}).then(function(n){v({parsed:n}),r(!1)})),w.setOptions({title:"Plugin Browser",headerRight:function(){return React.createElement(k,{style:{flexDirection:"row-reverse"}},React.createElement(T,{onPress:function(){return!i&&v({parsed:void 0})},icon:o.getAssetIDByName("ic_sync_24px"),style:"header"}),React.createElement(T,{onPress:function(){return!i&&j({key:"CardOverflow",options:Object.values(u).map(function(n){return{label:n,onPress:function(){return f(n)}}})})},icon:o.getAssetIDByName("ic_filter"),style:"header"}))}}),i||!s.parsed)return React.createElement(c.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let y=s.parsed.filter(function(n){return n.name?.toLowerCase().includes(h)||n.authors?.some(function(t){return t.name?.toLowerCase().includes(h)})||n.description?.toLowerCase().includes(h)});return[u.Alphabetical,u.ReverseAlphabetical].includes(l)&&(y=y.sort(function(n,t){return n.name<t.name?-1:n.name>t.name?1:0})),[u.ReverseAlphabetical,u.Newest].includes(l)&&y.reverse(),React.createElement(c.ReactNative.FlatList,{ListHeaderComponent:React.createElement(g.Search,{style:{marginBottom:10},onChangeText:function(n){return N(n.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:y,renderItem:function(n){let{item:t,index:Z}=n;return React.createElement(V,{index:Z,headerLabel:React.createElement(L,{style:D.text},t.name,t.authors[0]&&" by ",...t.authors.map(function(a,E,d){return React.createElement(React.Fragment,null,React.createElement(L,{onPress:function(){return F(a.id)},style:D.link},a.name),E!==d.length-1&&", ")})),headerIcon:o.getAssetIDByName(t.vendetta.icon),descriptionLabel:t.description,actions:function(){const a=`https://vd-plugins.github.io/proxy/${t.vendetta.original}`,E=U.plugins.plugins[a];return E?[E.manifest.hash!==t.hash&&{icon:o.getAssetIDByName("ic_sync_24px"),onPress:async function(d){if(!e[a]){e[a]=!0;try{await O(a),p.showToast(`Successfully updated ${t.name}.`,o.getAssetIDByName("ic_sync_24px"))}catch{p.showToast(`Failed to update ${t.name}!`,o.getAssetIDByName("Small"))}delete e[a],d()}}},{icon:o.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(d){if(!e[a]){e[a]=!0;try{I.removePlugin(a),p.showToast(`Successfully deleted ${t.name}.`,o.getAssetIDByName("ic_message_delete"))}catch{p.showToast(`Failed to delete ${t.name}!`,o.getAssetIDByName("Small"))}delete e[a],d()}}}].filter(function(d){return!!d}):[{icon:o.getAssetIDByName("ic_download_24px"),onPress:async function(d){if(!e[a]){e[a]=!0;try{await I.installPlugin(a),p.showToast(`Successfully installed ${t.name}.`,o.getAssetIDByName("toast_image_saved"))}catch(ee){p.showToast(ee?.message??`Failed to install ${t.name}!`,o.getAssetIDByName("Small"))}delete e[a],d()}}}]}})}})}const{FormRow:B}=g.Forms;function H(){const e=c.NavigationNative.useNavigation();return React.createElement(g.ErrorBoundary,null,React.createElement(B,{label:"Plugin Browser",leading:React.createElement(B.Icon,{source:o.getAssetIDByName("ic_search_items_24px")}),trailing:B.Arrow,onPress:function(){return e.push("VendettaCustomPage",{render:z})}}))}const{FormSection:K}=g.Forms,X=m.findByName("UserSettingsOverviewWrapper",!1);function Y(){let e=[],i=_.after("default",X,function(r,l){i();const f=P.findInReactTree(l.props.children,function(s){return s.type&&s.type.name==="UserSettingsOverview"});e.push(_.after("render",f.type.prototype,function(s,v){let{props:{children:h}}=v;const N=[c.i18n.Messages.BILLING_SETTINGS,c.i18n.Messages.PREMIUM_SETTINGS];h=P.findInReactTree(h,function(y){return y.children[1].type===K}).children;const w=h.findIndex(function(y){return N.includes(y?.props.label)});h.splice(w===-1?4:w,0,React.createElement(H,null))}))},!0);return function(){return e.forEach(function(r){return r()})}}const W=m.findByStoreName("UserStore"),{showUserProfile:q}=m.findByProps("showUserProfile"),{fetchProfile:J}=m.findByProps("fetchProfile");async function O(e){const i=e.enabled;for(let r=0;r<2;r++)i&&I.stopPlugin(e.id,!1),await I.fetchPlugin(e.id),i&&await I.startPlugin(e.id)}async function F(e){W.getUser(e)||await J(e),q({userId:e})}let $;var Q={onLoad:function(){return $=Y()},onUnload:function(){return $?.()}};return S.default=Q,S.openProfile=F,S.refetchPlugin=O,Object.defineProperty(S,"__esModule",{value:!0}),S})({},vendetta.plugins,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta,vendetta.ui.toasts);
